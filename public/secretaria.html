<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>LiberaÃ§Ã£o de Alunos - Secretaria</title>
</head>
<body>
  <h2>Nova LiberaÃ§Ã£o de Aluno</h2>

  <form id="form">
    <input placeholder="Aluno" id="aluno" required><br><br>
    <input placeholder="Turma" id="turma" required><br><br>
    <input placeholder="ResponsÃ¡vel" id="responsavel" required><br><br>
    <input placeholder="Telefone" id="telefone" required><br><br>
    <input placeholder="Terceiro autorizado" id="terceiro" required><br><br>
    <input placeholder="Documento" id="documento" required><br><br>
    <input placeholder="ObservaÃ§Ãµes" id="observacoes"><br><br>

    <button type="submit">Gerar LiberaÃ§Ã£o</button>
  </form>

  <hr>

  <h3 id="codigo"></h3>
  <img id="qrcode" style="display:none; width:200px">
  <br><br>
  <a id="pdf" href="#" target="_blank" style="display:none">
    ðŸ“„ Abrir PDF da LiberaÃ§Ã£o
  </a>

  <script>
    const API = "https://liberacao-alunos-backend.onrender.com";

    document.getElementById("form").addEventListener("submit", async (e) => {
      e.preventDefault();

      const dados = {
        aluno: aluno.value,
        turma: turma.value,
        responsavel: responsavel.value,
        telefone: telefone.value,
        terceiro: terceiro.value,
        documento: documento.value,
        observacoes: observacoes.value
      };

      const resposta = await fetch(API + "/liberacoes", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(dados)
      });

      const json = await resposta.json();

      // MOSTRAR CÃ“DIGO
      document.getElementById("codigo").innerText =
        "CÃ³digo gerado: " + json.codigo;

      // MOSTRAR QR CODE
      const img = document.getElementById("qrcode");
      img.src = json.qrCode;
      img.style.display = "block";

      // MOSTRAR PDF
      const pdf = document.getElementById("pdf");
      pdf.href = API + "/pdf/" + json.codigo;
      pdf.style.display = "inline-block";
    });
  </script>
</body>
</html>
